<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>UTM Tracking Demo</title>

    <script type="text/javascript">
        (function () {
            var didInit = false;
            function initMunchkin() {
                if (didInit === false) {
                    didInit = true;
                    Munchkin.init('990-HQY-353');
                }
            }
            var s = document.createElement('script');
            s.type = 'text/javascript';
            s.async = true;
            s.src = '//munchkin.marketo.net/munchkin.js';
            s.onreadystatechange = function () {
                if (this.readyState == 'complete' || this.readyState == 'loaded') {
                    initMunchkin();
                }
            };
            s.onload = initMunchkin;
            document.getElementsByTagName('head')[0].appendChild(s);
        })();
    </script>

    <script src="//990-HQY-353.marketo.com/js/forms2/js/forms2.min.js"></script>
</head>

<body>
    <h2>UTM Tracking Demo</h2>
    <form id="mktoForm_1234"></form>

    <script>
        MktoForms2.loadForm("//990-HQY-353.marketo.com", "990-HQY-353", 1099);
    </script>

    <script>
      (function () {
        const utmKeys = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_content'];

        function getUTMsFromURL() {
          const params = new URLSearchParams(window.location.search);
          utmKeys.forEach(key => {
            const val = params.get(key);
            if (val) localStorage.setItem(key, val);
          });
        }

        function populateFormFields(form) {
          utmKeys.forEach(key => {
            const val = localStorage.getItem(key);
            if (val) {
              const field = form.getFormElem().find(`input[name="${key}"]`);
              if (field.length) field.val(val);
            }
          });
        }

        getUTMsFromURL();
        MktoForms2.whenReady(function (form) {
          populateFormFields(form);
        });
      })();
    </script>

    <script>
        (function () {
            var didInit = false;
            function initMunchkin() {
                if (!didInit) {
                    didInit = true;
                    Munchkin.init('990-HQY-353', { domainLevel: 2 });
                }
            }
            var s = document.createElement('script');
            s.type = 'text/javascript'; s.async = true; s.src = '//munchkin.marketo.net/munchkin.js';
            s.onreadystatechange = function () {
                if (this.readyState === 'complete' || this.readyState === 'loaded') initMunchkin();
            };
            s.onload = initMunchkin;
            document.head.appendChild(s);
        })();
    </script>
</body>

</html>